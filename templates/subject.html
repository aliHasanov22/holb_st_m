{% extends "base.html" %}
{% block content %}
  <h3>{{ subject.name }}</h3>

  {% if request.query_params.get("sc") %}
    <div class="card">
      <b>Quiz result:</b> {{ request.query_params.get("sc") }}/{{ request.query_params.get("tot") }}
    </div>
  {% endif %}

  <div class="card">
    <h4>Add notes</h4>
    <form method="post" action="/subjects/{{ subject.id }}/notes">
      <textarea name="content" placeholder="Paste your notes here..." required></textarea>
      <br/><br/>
      <button type="submit">Generate Summary + Flashcards</button>
    </form>
    <div class="muted" style="margin-top:10px;">
      If OpenAI key isnâ€™t set, it uses offline summarizer/flashcards.
    </div>
  </div>

  <h4>Notes</h4>
  {% for n in notes %}
    <div class="card">
      <div class="muted">{{ n.created_at }}</div>
      <details>
        <summary><b>Summary</b></summary>
        <pre style="white-space:pre-wrap;">{{ n.summary }}</pre>
      </details>
      <details>
        <summary><b>Flashcards</b></summary>
        <pre style="white-space:pre-wrap;">{{ n.flashcards_json }}</pre>
      </details>

      <form method="post" action="/subjects/{{ subject.id }}/quiz/start" style="margin-top:10px;">
        <input type="hidden" name="note_id" value="{{ n.id }}"/>
        <button type="submit">Start Quiz (from this note)</button>
      </form>

      {% if request.query_params.get("quiz") %}
        <hr/>
        <form method="post" action="/subjects/{{ subject.id }}/quiz/submit">
          <div><b>Answer 5 questions (type short answers)</b></div>
          <div class="muted">Tip: This demo grades by keyword overlap.</div>
          <br/>
          <input name="a1" type="text" placeholder="Answer 1"/><br/><br/>
          <input name="a2" type="text" placeholder="Answer 2"/><br/><br/>
          <input name="a3" type="text" placeholder="Answer 3"/><br/><br/>
          <input name="a4" type="text" placeholder="Answer 4"/><br/><br/>
          <input name="a5" type="text" placeholder="Answer 5"/><br/><br/>
          <button type="submit">Submit Quiz</button>
        </form>
      {% endif %}
    </div>
  {% else %}
    <p class="muted">No notes yet.</p>
  {% endfor %}

  <h4>Recent quiz results</h4>
  {% for r in quiz_results %}
    <div class="card">
      Score: <b>{{ r.score }}/{{ r.total }}</b> <span class="muted">({{ r.created_at }})</span>
    </div>
  {% else %}
    <p class="muted">No quiz results yet.</p>
  {% endfor %}
{% endblock %}
